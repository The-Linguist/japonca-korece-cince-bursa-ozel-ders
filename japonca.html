<html lang="tr" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>JAPONCA</title>
    <link rel="stylesheet" href="video_ile_submit.css">
    <script src="ua-parser.min.js"></script>
    <style>
      main{background-image: url("japanbg.webp");}
    </style>

    <!-- Google tag (gtag.js) ANALYTICS -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HKPP55Q9QH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-HKPP55Q9QH');
    </script>


    <script type="application/javascript">
      var ipNo = "bel.ir.siz.I.P";
      function getIP(json) {
        //document.write("My public IP address is: ", json.ip);
        ipNo = json.ip;
      }
    </script>
    <script type="application/javascript" src="https://api.ipify.org?format=jsonp&callback=getIP"></script>

  </head>
  <body>
    <main>
      <section>
        <video poster="hitoca_poster.jpg" src="hitoca.webm" controls playsinline onplay="videoIzleniyor(); "></video>
        <div id="playDugmesiParentID" class="">
          <button type="button" style="" onmouseup="top.location.assign('https://the-linguist.github.io/japonca-korece-cince-bursa-ozel-ders/');">Ana sayfaya geri dön</button>
          <button id="playDugmesi" type="button" name="button" onmousedown="playVideo();" onmouseup="this.parentNode.style.display='none';">Videoyu başlat</button>
        </div>
        <div class="videoBitinceGozuk" style="visibility: hidden;">
          <h2>Talep oluşturmak için adınızı yazdıktan sonra altına telefonunuzu ya da <span style="white-space:nowrap;">e-mail<span> adresinizi ekleyiniz</h2>
          <textarea onfocus="videoyuKucult();" oninput="birseylerYaziliyor()"></textarea>
          <div class="">
            <button type="button" style="" onmouseup="top.location.assign('https://the-linguist.github.io/japonca-korece-cince-bursa-ozel-ders/');">Ana sayfaya geri dön</button>
            <button id="gonderDugmesi" disabled role="button">Ders talebini gönder</button>
          </div>
        </div>
        <div class="gonderilinceGozuk">
          <h2>Teşekkür ederiz.<br>Talebiniz alındı.<br>Size dönmemiz bir kaç iş günü sürebilir.</h2>
        </div>
      </section>
    </main>
    <footer>
      <div class="">
        <p>Bu sayfaya tekrar ulaşmak için link</p>
        <p>
          <a href="https://bit.ly/3Wp0jpv">bit.ly/3Wp0jpv</a>
        </p>
      </div>
    </footer>
    <script type="text/javascript">
      var isApple = false;
      var parser = new UAParser();
      var result = parser.getResult();
      console.log(result.browser.name);
      console.log(result.os.name);
      //---
      const v = document.getElementsByTagName('video')[0];

      if (result.os.name == "Mac OS" || result.os.name == "iOS") {
        v.src='hitoca.mp4';
      }

      const talep = document.getElementsByTagName('h2')[0];
      var metin = document.getElementsByTagName('textarea')[0];
      var dugme = document.getElementById('gonderDugmesi');
      const footerBitly = document.getElementsByTagName('footer')[0];

      function playVideo() { // onmousedown or 10s timeout
        v.play();
      }
      window.addEventListener("load",startCountDown);
      function startCountDown() {
        setTimeout(function () {
          if (!localStorage.isFirstVisit) {
            playVideo();
            document.getElementById('playDugmesiParentID').style.display = "none";
          } else {
            localStorage.isFirstVisit = "yep";
          }
        }, 8500);
      }

      function videoyuKucult() {
        v.style.width = "20vh"; v.style.height = "20vh";
        talep.style.transform = "scale(0.88)";
        talep.style.fontSize = "calc(1.5vmin + 6px)";
        footerBitly.style.display = "none";
      }

      function birseylerYaziliyor() {
        if (metin.value.length==5) {
          dugme.removeAttribute("disabled");
        }
      }

      var firstPlay = true;
      if (localStorage.buVideonunIlkIzlenisiDegil) {
        firstPlay = false;
        setTimeout(function () {
          document.querySelector('.videoBitinceGozuk').style.visibility = "visible";
          document.querySelector('.videoBitinceGozuk').style.opacity = "1";
        }, 2000);
      }
      function videoIzleniyor() {
        if (firstPlay) {
          let mesajKutusuBelirmeSuresi = 12000;
          setTimeout(function () {
            document.querySelector('.videoBitinceGozuk').style.visibility = "visible";
            document.querySelector('.videoBitinceGozuk').style.opacity = "1";
            localStorage.buVideonunIlkIzlenisiDegil = "evet";
          }, mesajKutusuBelirmeSuresi);
        }
        firstPlay = false;
      }
    </script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js">
    </script>
    <script type="text/javascript">
       (function(){
          emailjs.init("S0l8VULAFRYrIGIFi");
       })();
    </script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
      ////import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-analytics.js";
      // Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyD75Y5wEPgXnenZukpBwTMEFcF_A2dmtpM",
        authDomain: "ozel-ders-basvuru-topla.firebaseapp.com",
        databaseURL: "https://ozel-ders-basvuru-topla-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "ozel-ders-basvuru-topla",
        storageBucket: "ozel-ders-basvuru-topla.appspot.com",
        messagingSenderId: "406858837266",
        appId: "1:406858837266:web:e6cc72f2292e5cdf45d7cb",
        ////measurementId: "G-HKPP55Q9QH"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      ////const analytics = getAnalytics(app);
      dugme.addEventListener("mouseup",writeUserData);
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-database.js";
      function writeUserData() {
        dugme.innerHTML = "Bağlanıyor";
        dugme.setAttribute("disabled", "");
        const d = new Date();
        const tarih = d.toUTCString();
        const basvuranNeYazmis = metin.value + " :: JAPONCA İÇİN BAŞVURUSUNU YAPTI";
        const db = getDatabase();
        //---- To firebase
        set(ref(db, tarih), basvuranNeYazmis).then(() => {
          document.querySelector('.videoBitinceGozuk').style.display = "none";
          document.querySelector('.gonderilinceGozuk').style.display = "block";
        })
        .catch((error) => {
          alert("Bağlantı hatası nedeniyle kayıt alınamadı");
        });
        //---- To emailjs
        var templateParams = {              name: '---',              notes: '....'          };
        emailjs.send('service_7mfbarw', 'template_756poag', templateParams)
        .then(function(response) {
           console.log('SUCCESS!', response.status, response.text);
        }, function(error) {
           console.log('FAILED...', error);
        });
      }
      // -----
      v.addEventListener("play",writeUserIPWithFirstPlay,{once:true});
      function writeUserIPWithFirstPlay() {
        const db = getDatabase();
        const i = ipNo.split(".");
        const p = i[0]+"_"+i[1]+"_"+i[2]+"_"+i[3];
        //---- To firebase
        set(ref(db, p), " video izlemeye başladı").then(() => {
          console.log("ip -> OK");
        })
        .catch((error) => {
          console.error("No firebase? offline?");
        });
      }
      // -----
      v.addEventListener("ended",writeUserIPWhenVideoEnds,{once:true});
      function writeUserIPWhenVideoEnds() {
        const db = getDatabase();
        const i = ipNo.split(".");
        const p = i[0]+"_"+i[1]+"_"+i[2]+"_"+i[3];
        //---- To firebase
        set(ref(db, p), " videoyu sonuna kadar izledi").then(() => {
          console.log("ip -> OK");
        })
        .catch((error) => {
          console.error("No firebase? offline?");
        });
      }
      // -----
      function writeUserIPBeforeVidPlay() {
        const db = getDatabase();
        const i = ipNo.split(".");
        const p = i[0]+"_"+i[1]+"_"+i[2]+"_"+i[3];
        //---- To firebase
        set(ref(db, p), " video sayfasına ulaştı").then(() => {
          console.log("ip -> OK");
        })
        .catch((error) => {
          console.error("No firebase? offline?");
        });
      }
      writeUserIPBeforeVidPlay();
    </script>

  </body>
</html>
